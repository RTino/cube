<!DOCTYPE html>

<html>
<head>
  <title>profile.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.coffee
              </a>
            
              
              <a class="source" href="collection.html">
                collection.coffee
              </a>
            
              
              <a class="source" href="facets.html">
                facets.coffee
              </a>
            
              
              <a class="source" href="index.html">
                index.coffee
              </a>
            
              
              <a class="source" href="facetArray.html">
                facetArray.coffee
              </a>
            
              
              <a class="source" href="schema.html">
                schema.coffee
              </a>
            
              
              <a class="source" href="facet.html">
                facet.coffee
              </a>
            
              
              <a class="source" href="item.html">
                item.coffee
              </a>
            
              
              <a class="source" href="print.html">
                print.coffee
              </a>
            
              
              <a class="source" href="routes.html">
                routes.coffee
              </a>
            
              
              <a class="source" href="facet.html">
                facet.coffee
              </a>
            
              
              <a class="source" href="item.html">
                item.coffee
              </a>
            
              
              <a class="source" href="profile.html">
                profile.coffee
              </a>
            
              
              <a class="source" href="cube.html">
                cube.coffee
              </a>
            
              
              <a class="source" href="code.html">
                code.coffee
              </a>
            
              
              <a class="source" href="server.config.html">
                server.config.coffee
              </a>
            
              
              <a class="source" href="server.routes.html">
                server.routes.coffee
              </a>
            
              
              <a class="source" href="server.settings.html">
                server.settings.coffee
              </a>
            
              
              <a class="source" href="entityController.html">
                entityController.coffee
              </a>
            
              
              <a class="source" href="extensionController.html">
                extensionController.coffee
              </a>
            
              
              <a class="source" href="facetManager.html">
                facetManager.coffee
              </a>
            
              
              <a class="source" href="itemController.html">
                itemController.coffee
              </a>
            
              
              <a class="source" href="printController.html">
                printController.coffee
              </a>
            
              
              <a class="source" href="schema.html">
                schema.coffee
              </a>
            
              
              <a class="source" href="solrManager.html">
                solrManager.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>profile.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h3>Pane View</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>$ -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Defines a parent class for profile and group views.
A pane is located on the right side of the application and contains
either a profile view or a group view. It can also be extended to
allocate other things such as a Team view for the team app.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="class"><span class="keyword">class</span> <span class="title">window</span>.<span class="title">BasePaneView</span> <span class="keyword">extends</span> <span class="title">Backbone</span>.<span class="title">View</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h3>Initialize</h3>
<ol>
<li>Point to app</li>
<li>Listen for ESC keybinding</li>
<li>Re-Set arrow keys movements on app</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>        initialize: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Handy pointer to the app</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@app</span> = window.App</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Clear all keybindings, then add close on ESC and re-add movement
keybindings on content area.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setKeybindings</span>()
            <span class="property">@app</span>.setMoveKeybindings()</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Make some space on the container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'.thumbnailContainer, #tableContainer'</span>)
                .addClass <span class="string">'onProfile'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Also move the footer to the right</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'#footer, #columnsSelectWrapper'</span>).addClass <span class="string">'onProfile'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Show pane. .show() fails on some browsers.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'#pane'</span>).css(<span class="string">'display'</span>, <span class="string">'block'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h3>Set Model properties</h3>
<p>Set values on a model for text, date and picture fields, and allow
unsetting empty properties if required.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setModel: (m, unset, cb) -&gt;

            <span class="property">@setModelTextFields</span> m, unset

            <span class="property">@setModelIntFields</span> m, unset

            <span class="property">@setModelDropdownFields</span> m, unset

            <span class="property">@setModelDateFields</span> m, unset

            <span class="property">@setModelPicFields</span> m, unset

            <span class="property">@setModelFacetFields</span> m, unset

            <span class="property">@setModelTupleFields</span> m, unset

            cb() <span class="keyword">if</span> cb</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Sets a model&#39;s text properties: strings, emails and multilines.
All of these fields are stored in the DB as strings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setModelTextFields: (m, unset) =&gt;

            _.each $(<span class="string">'input, textarea'</span>, <span class="string">'#pane'</span>), (i) =&gt;

                $i = $(i)

                id = $i.attr <span class="string">'id'</span>

                f = window.Settings.Schema.getFieldById id.split(<span class="string">'_'</span>)[<span class="number">0</span>]

                <span class="keyword">return</span> <span class="keyword">unless</span> !f.type <span class="keyword">or</span> f.type <span class="keyword">is</span> <span class="string">"text"</span> <span class="keyword">or</span>
                    f.type <span class="keyword">is</span> <span class="string">"email"</span> <span class="keyword">or</span>  f.type <span class="keyword">is</span> <span class="string">"multiline"</span> <span class="keyword">or</span>
                    f.type <span class="keyword">is</span> <span class="string">"skype"</span>

                val = $.trim $i.val()

                <span class="keyword">return</span> m.unset(id, silent: <span class="literal">yes</span>) <span class="keyword">if</span> !val <span class="keyword">and</span> unset

                p = {}
                p[id] = val
                m.set p, silent: <span class="literal">yes</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Sets a model&#39;s numeric field: integer and float. These fields are
stored as integer or float respectively.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setModelIntFields: (m, unset) =&gt;

            _.each $(<span class="string">'input'</span>, <span class="string">'#pane'</span>), (i) =&gt;

                $i = $(i)

                id = $i.attr <span class="string">'id'</span>

                f = window.Settings.Schema.getFieldById id.split(<span class="string">'_'</span>)[<span class="number">0</span>]

                <span class="keyword">return</span> <span class="keyword">unless</span> !f.type <span class="keyword">or</span> f.type <span class="keyword">is</span> <span class="string">"integer"</span> <span class="keyword">or</span>
                    f.type <span class="keyword">is</span> <span class="string">"float"</span>

                val = $.trim $i.val()

                <span class="keyword">return</span> m.unset(id, silent: <span class="literal">yes</span>) <span class="keyword">if</span> !val <span class="keyword">and</span> unset

                p = {}
                p[id] = val

                m.set p, silent: <span class="literal">yes</span> <span class="keyword">if</span> val</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Sets a model&#39;s dropdown properties. These fields are also
stored as strings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setModelDropdownFields: (m, unset) =&gt;

            _.each $(<span class="string">'select'</span>, <span class="string">'#pane'</span>), (i) =&gt;

                $i = $(i)

                id = $i.attr <span class="string">'id'</span>

                val = $.trim $i.val()

                <span class="keyword">return</span> m.unset id, silent: <span class="literal">yes</span> <span class="keyword">if</span> unset <span class="keyword">unless</span> val

                <span class="keyword">if</span> val <span class="keyword">and</span> val[<span class="number">0</span>] <span class="keyword">isnt</span> <span class="string">""</span>
                    p = {}
                    p[id] = val
                    <span class="keyword">return</span> m.set p, silent: <span class="literal">yes</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Sets a model&#39;s date fields. Stored as javascript ISO date strings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setModelDateFields: (m, unset) =&gt;

            _.each $(<span class="string">'input[data-type="date"]'</span>, <span class="string">'#pane'</span>), (i) -&gt;

                id = $(i).attr <span class="string">'id'</span>

                dateValue = <span class="keyword">new</span> Date $(i).val()

                o = {}
                o[id] = dateValue

                <span class="keyword">return</span> m.set o, silent: <span class="literal">yes</span> <span class="keyword">unless</span> isNaN dateValue

                m.unset id, silent: <span class="literal">yes</span> <span class="keyword">if</span> unset</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Set a model&#39;s picture field from the picture HTML element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setModelPicFields: (m, unset) =&gt;

            picFields = window.Settings.Schema.getPictures()

            _.each picFields, (pf) -&gt;

                id = pf.id

                $i = $(<span class="string">"#picture"</span>, <span class="string">'#pane'</span>)

                <span class="keyword">return</span> <span class="keyword">unless</span> $i.attr <span class="string">'src'</span>

                o = {}
                o[id] = $i.attr <span class="string">'src'</span>

                m.set o, silent: <span class="literal">yes</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Set a model&#39;s facet fields.
Facet fields are multivalue. they will be stored as arrays of strings
in the database, along with a sort field which contains a comma
separated list of facet names, since Solr is not able to sort on
multivalue fields.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setModelFacetFields: (m, unset) =&gt;

            _.each $(<span class="string">'input.facet'</span>), (i) =&gt;

                $i = $(i)

                id = $i.attr <span class="string">'id'</span>

                val = []

                f = window.Settings.Schema.getFieldById id.split(<span class="string">'_'</span>)[<span class="number">0</span>]

                _.each $i.val().split(<span class="string">','</span>), (v) =&gt;
                    <span class="property">@setUniqueMultivalueField</span> v, val

                <span class="keyword">return</span> m.unset(id, silent: <span class="literal">yes</span>) <span class="keyword">if</span> !val.length <span class="keyword">and</span> unset

                p = {}
                p[id] = val

                m.set p, silent: <span class="literal">yes</span> <span class="keyword">if</span> val.length</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Sets the tuple property and also the related properties. i.e. for
tuple team:role it also sets team and role properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setModelTupleFields: (m, unset) =&gt;

            _.each $(<span class="string">'.tupleWrapper'</span>), (te) =&gt;

                $te     = $(te)                     <span class="comment"># tuple element</span>
                tups    = []                        <span class="comment"># list of tuples</span>
                pval1   = []                        <span class="comment"># vals for related field 1</span>
                pval2   = []                        <span class="comment"># vals for related field 2</span>
                p       = {}                        <span class="comment"># property obj to be set</span>
                tid     = $te.attr(<span class="string">'id'</span>)            <span class="comment"># name of tuple (team:role)</span>
                [ pid1, pid2 ] = tid.split(<span class="string">':'</span>)     <span class="comment"># tuple id part 1 and 2</span>

                _.each $(<span class="string">'.tupleField'</span>, $te), (i) =&gt;

                    $i = $(i)

                    v1 = $.trim $(<span class="string">'input.p1'</span>, $i).val()
                    v2 = $.trim $(<span class="string">'input.p2'</span>, $i).val()</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>tuple values may contain both parts or just one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    tv = <span class="string">"<span class="subst">#{v1}</span>:<span class="subst">#{v2}</span>"</span> <span class="keyword">if</span> v1 <span class="keyword">or</span> v2
                    tups.push tv <span class="keyword">if</span> tv <span class="keyword">and</span> tups.indexOf(tv) <span class="keyword">is</span> -<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Aggregate all values from one part and from the other, to
store in the respective fields. It is important that we
only store unique values like &#39;team/subteam1/group1&#39;
instead of &#39;team, team/subteam1, team/subteam1/group1&#39;.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="property">@setUniqueMultivalueField</span> v1, pval1
                    <span class="property">@setUniqueMultivalueField</span> v2, pval2</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Property object contains tuple field and related fields.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                p[tid]  = tups
                p[pid1] = pval1
                p[pid2] = pval2

                <span class="keyword">if</span> !pval1.length <span class="keyword">and</span> !pval2.length <span class="keyword">and</span> unset
                    <span class="keyword">return</span> m.unset(tid, silent:<span class="literal">yes</span>)

                m.set(p, silent: <span class="literal">yes</span>) <span class="keyword">if</span> pval1.length <span class="keyword">or</span> pval2.length</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Propperly removes a pane view by unbinding all events, keybindings
and resetting css clases before removing the actual html element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        destroy: () =&gt;

            <span class="property">@unbind</span>()

            <span class="property">@unsetKeybindings</span>()

            $(<span class="string">'.onProfile'</span>).removeClass <span class="string">'onProfile'</span>

            <span class="property">@remove</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Close the profileView. User clicked on &quot;X&quot; link on top right corner</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        close: () =&gt;

            <span class="property">@app</span>.clearSelection()

            <span class="property">@destroy</span>()

            $(<span class="string">'#pane'</span>).hide()

            <span class="property">@app</span>.navigate()</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Handle filtering from data values that are part of the facets.
i.e. by clicking on an items profile view data field.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        filterByDetail: (e) =&gt;

            $e = $(e.currentTarget)

            cat = $e.attr <span class="string">'data-name'</span>
            field = $e.attr <span class="string">'data-title'</span>

            <span class="property">@app</span>.setFacetState [ { cat: cat, field: field } ]

            <span class="property">@app</span>.filterByFacet()

            <span class="keyword">return</span> <span class="keyword">unless</span> field.split(<span class="string">'/'</span>)[<span class="number">1</span>]

            parentFacet = field.split(<span class="string">'/'</span>)[<span class="number">0</span>]

            <span class="property">@app</span>.facetOpenState.set [ { cat: cat, field: parentFacet } ]</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Appends unique values to a given array, based on a comma separated
list of values. Unique values refer to values such as:
&#39;team/subteam1/group1&#39; instead of
&#39;team, team/subteam1, team/subteam1/group1&#39;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setUniqueMultivalueField: (list, arr) -&gt;

            _.each <span class="property">@getMultivalueField</span>(list), (v) -&gt;

                arr.push v <span class="keyword">if</span> arr.indexOf(v) <span class="keyword">is</span> -<span class="number">1</span> <span class="keyword">and</span> v</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Parse an input field that has multiple values and form an array of
unique values useful for Solr.
i.e. Novel/Sci-Fi =&gt; [ &#39;Novel&#39;, &#39;Novel/Sci-Fi&#39; ]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getMultivalueField: (field) =&gt;

            uniqueFields = []

            values = field.split <span class="string">','</span>

            _.each values, (v, i) =&gt;

                v = v.slice(<span class="number">1</span>) <span class="keyword">if</span> v[<span class="number">0</span>] <span class="keyword">is</span> <span class="string">' '</span>

                _.each <span class="property">@getUniqueValues</span>(v), (v) -&gt;

                    uniqueFields.push(v) <span class="keyword">if</span> uniqueFields.indexOf(v) <span class="keyword">is</span> -<span class="number">1</span>

            uniqueFields</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Given a value like Team/subteam1/group1 returns a list of values like
team, team/subteam1, team/subteam1/group1.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getUniqueValues: (value) =&gt;

            uniqueValues = []

            sep = window.Settings.separator
            tokens = value.split sep

            _.each value.split(sep), (v, i) -&gt;

                u = tokens.slice(<span class="number">0</span>, i).join(sep)

                uniqueValues.push u <span class="keyword">if</span> u

            uniqueValues.push value

            uniqueValues</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Append another tuple fields after last one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        addTupleField: (e) -&gt;

            $e = $(e.currentTarget)

            <span class="keyword">return</span> <span class="keyword">unless</span> $(<span class="string">'.p1'</span>, $e).val() <span class="keyword">or</span> $(<span class="string">'.p2'</span>, $e).val()

            $p = $e.parent()

            tupleId = $e.attr <span class="string">'id'</span>

            template = _.template $(<span class="string">'#tuple-field-template'</span>).html()

            $p.append template id: tupleId

            <span class="property">@setAutoComplete</span> $(<span class="string">'input.autocomplete'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Self explanatory</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        removeEmptyTupleFields: (e) -&gt;

            $tf = $(<span class="string">'.tupleField'</span>)

            _.each $tf, (t, i, tf) -&gt;

                $t = $(t)
                $i1 = $(<span class="string">'.p1'</span>, $t)
                $i2 = $(<span class="string">'.p2'</span>, $t)

                $t.remove() <span class="keyword">unless</span> $i1.val() <span class="keyword">or</span> $i2.val() <span class="keyword">or</span> i <span class="keyword">is</span> tf.length-<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Easy validation. Checks for values on any input field and matches
for emails on email input fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        formIsValid: () -&gt;

            validForm = <span class="literal">true</span>

            $(<span class="string">'.validationFailed'</span>, <span class="string">'#pane'</span>).removeClass(<span class="string">'validationFailed'</span>)

            inputFields = window.Settings.Schema.getMandatories()

            _.each inputFields, (f, i, fields) =&gt;

                validField = <span class="literal">true</span>

                input = $(<span class="string">"input#<span class="subst">#{f.id}</span>"</span>, <span class="string">"#pane"</span>)

                validField = <span class="literal">false</span> <span class="keyword">if</span> !input.val()

                validField = <span class="literal">false</span> <span class="keyword">if</span> f.type <span class="keyword">is</span> <span class="string">'email'</span> <span class="keyword">and</span>
                    !<span class="property">@emailValid</span> input.val()

                input.addClass(<span class="string">'validationFailed'</span>) <span class="keyword">unless</span> validField

                validForm = <span class="literal">false</span> <span class="keyword">unless</span> validField

            validForm</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Email validation, match against a regexp.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        emailValid: (email) -&gt;

            re = [ <span class="string">'^(([^&lt;&gt;()[\\]\\.,;:\\s@\\"]'</span>
                , <span class="string">'+(\.[^&lt;&gt;()[\\]\\.,;:\\s@\\"]+)*)'</span>
                , <span class="string">'|(\\".+\\"))@((\\[[0-9]{1,3}\\.'</span>
                , <span class="string">'[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])'</span>
                , <span class="string">'|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$'</span> ]

            re = RegExp re.join <span class="string">''</span>

            re.test email</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Attach autocomplete plugin to input fields (i.e. team, role).
There must be a resource to get an array with the values. The name of
the resource should match the id of the html element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setAutoComplete: ($elements) -&gt;

            $.get <span class="string">'ufacets'</span>, (fd) =&gt;

                _.each $elements, (e) =&gt;

                    $e = $(e)
                    id = $e.attr <span class="string">'id'</span>
                    id = id.split(<span class="string">':'</span>)[<span class="number">0</span>] <span class="keyword">if</span> $e.hasClass <span class="string">'p1'</span>
                    id = id.split(<span class="string">':'</span>)[<span class="number">1</span>].split(<span class="string">'_'</span>)[<span class="number">0</span>] <span class="keyword">if</span> $e.hasClass <span class="string">'p2'</span>

                    $e.autocomplete source: fd[id]</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Attach fileupload plugin to picture input field.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setFileupload: ($e) -&gt;

            $e.attr <span class="string">'data-url'</span>, <span class="string">"/<span class="subst">#{window.entity}</span>/picture/"</span>

            $e.fileupload
                dataType: <span class="string">'json'</span>
                done: ($e, data) -&gt;
                    $.each data.result, (index, file) -&gt;
                        $(<span class="string">'#picture'</span>).attr(<span class="string">'src'</span>, file.url).one <span class="string">'load'</span>, () -&gt;
                            $(<span class="string">'#pictureContainer'</span>)
                                .removeClass(<span class="string">'validationFailed'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Attach datepicker plugin to a given input field</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setDatePicker: ($e) -&gt;

            $e.datepicker

                changeYear      : <span class="literal">true</span>
                changeMonth     : <span class="literal">true</span>
                constrainInput  : <span class="literal">true</span>
                showButtonPanel : <span class="literal">true</span>
                showOtherMonths : <span class="literal">true</span>
                yearRange       : <span class="string">"c-70"</span>
                dateFormat      : <span class="string">"d M yy"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Attach keybinding handlers like close on ESC and arrow keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setKeybindings: () =&gt;

            <span class="property">@unsetKeybindings</span>()

            $(<span class="string">'body'</span>).keyup <span class="property">@closeOnEsc</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Close profile view when user hits ESC key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        closeOnEsc: (e) =&gt;

            <span class="property">@close</span>() <span class="keyword">if</span> e.keyCode <span class="keyword">is</span> <span class="number">27</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Dettach all pane keybindings on body</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        unsetKeybindings: () =&gt;

            $(<span class="string">'body'</span>).unbind <span class="string">'keyup'</span>, <span class="property">@closeOnEsc</span></pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Stop animation if mouse leaves arrows</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        onMouseOut: () =&gt;

            clearTimeout <span class="property">@scrollTimer</span></pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Stop animation if mouse enters the text container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        onTextContainer: () =&gt;

            clearTimeout <span class="property">@scrollTimer</span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Reset text position to left:0 after the cursor has left for 2 seconds</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        onTextContainerOut: (e) =&gt;

            clearTimeout <span class="property">@scrollTimer</span>

            <span class="property">@scrollTimer</span> = setTimeout () =&gt;
                <span class="property">@resetTextPosition</span> e
                , <span class="number">2000</span></pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Handle animation to reset the text to left:0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        resetTextPosition: (e) =&gt;

            $e = $(e.currentTarget)

            clearTimeout <span class="property">@scrollTimeout</span>

            <span class="keyword">return</span> <span class="keyword">if</span> parseFloat($e.css(<span class="string">'left'</span>).split(<span class="string">'px'</span>)[<span class="number">0</span>]) &gt;= <span class="number">0</span>

            <span class="property">@scrollTimeout</span> = setTimeout () =&gt;
                <span class="property">@resetTextPosition</span> e
                , <span class="number">1</span>

            <span class="property">@animateText</span> $e, <span class="string">'left'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Handles animation on text with directions &#39;left&#39; or &#39;right&#39;.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        animateText: ($e, dir) =&gt;

            x = parseFloat $e.css(<span class="string">'left'</span>).split(<span class="string">'px'</span>)[<span class="number">0</span>]

            <span class="keyword">return</span> $e.css(<span class="string">'left'</span>, (x+<span class="number">1</span>)+<span class="string">'px'</span>) <span class="keyword">if</span> dir <span class="keyword">is</span> <span class="string">'left'</span>

            $e.css(<span class="string">'left'</span>, (x-<span class="number">1</span>)+<span class="string">'px'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Handles scrolling of long detailed data fields, showing arrows on
sides of data fields and taking care of animations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        onScroll: (e) =&gt;

            $e = $(e.currentTarget)
            $p = $e.siblings(<span class="string">'.text-container'</span>)
            w = parseFloat $p.css(<span class="string">'width'</span>).split(<span class="string">'px'</span>)[<span class="number">0</span>]
            x = parseFloat $p.css(<span class="string">'left'</span>).split(<span class="string">'px'</span>)[<span class="number">0</span>]

            clearTimeout <span class="property">@scrollTimer</span>

            <span class="property">@scrollTimer</span> = setTimeout () =&gt;
                <span class="property">@onScroll</span> e
              ,
                <span class="number">10</span>

            id = $e.attr <span class="string">'id'</span>

            $(<span class="string">'span.scroll#left, span.scroll#right'</span>, $p.parent()).show()
            $(<span class="string">'span.scroll#left'</span>, $p.parent()).hide() <span class="keyword">if</span> x <span class="keyword">is</span> <span class="number">0</span>
            $(<span class="string">'span.scroll#right'</span>, $p.parent()).hide() <span class="keyword">if</span> x <span class="keyword">is</span> (w - <span class="number">188</span>) * -<span class="number">1</span>
            $(<span class="string">'span.scroll#right'</span>, $p.parent()).hide() <span class="keyword">if</span> w &lt; <span class="number">178</span>

            <span class="keyword">if</span> id <span class="keyword">is</span> <span class="string">'left'</span> <span class="keyword">and</span> x &gt;= <span class="number">0</span>
                <span class="keyword">return</span> clearTimeout <span class="property">@scrollTimer</span>
            <span class="keyword">if</span> id <span class="keyword">is</span> <span class="string">'right'</span><span class="keyword">and</span> x &lt;= (w - <span class="number">168</span>) * -<span class="number">1</span>
                <span class="keyword">return</span> clearTimeout <span class="property">@scrollTimer</span>
            <span class="property">@animateText</span> $p, id</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <h3>Profile View</h3>
<p>A detailed view of an item that shows up on the right pane.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="class"><span class="keyword">class</span> <span class="title">window</span>.<span class="title">ProfileView</span> <span class="keyword">extends</span> <span class="title">window</span>.<span class="title">BasePaneView</span></span>

        tagName: <span class="string">'div'</span>


        template: _.template $(<span class="string">'#details-template'</span>).html()


        events:

            <span class="string">"click a#edit"</span>                  : <span class="string">"form"</span>
            <span class="string">"click a#save"</span>                  : <span class="string">"save"</span>
            <span class="string">"click a#delete"</span>                : <span class="string">"clear"</span>
            <span class="string">"click a.destroy"</span>               : <span class="string">"close"</span>
            <span class="string">"click label.additional"</span>        : <span class="string">"showAdditionalFields"</span>
            <span class="string">"mouseover span.scroll"</span>         : <span class="string">"onScroll"</span>
            <span class="string">"mouseout span.scroll"</span>          : <span class="string">"onMouseOut"</span>
            <span class="string">"mouseover .text-container"</span>     : <span class="string">"onTextContainer"</span>
            <span class="string">"mouseout .text-container"</span>      : <span class="string">"onTextContainerOut"</span>
            <span class="string">"click a.filter"</span>                : <span class="string">"filterByDetail"</span>
            <span class="string">"keyup .tupleField:last-child"</span>  : <span class="string">"addTupleField"</span>
            <span class="string">"focus .tupleField"</span>             : <span class="string">"removeEmptyTupleFields"</span>
            <span class="string">"keypress"</span>                      : <span class="string">"save"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Initialize profile view by destroying previous views, binding to
important events and moving the content area to make some space.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        initialize: () -&gt;

            <span class="keyword">super</span></pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Destroy all previous profileViews</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.profileView?.destroy()</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Bindings for items collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.collection.bind <span class="string">'reset'</span>, <span class="property">@onReset</span>, @</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Bindings for the changes on the collection after a search</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@app</span>.bind <span class="string">'filter'</span>, <span class="property">@close</span>, @</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Move right border of content area to make some space for
the profile.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'.thumbnailContainer'</span>).addClass <span class="string">'onProfile'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Render profile inside #pane</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        render: () =&gt;

            <span class="property">@$el</span>.html <span class="property">@template</span> m: <span class="property">@model</span>
            @</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Delete an item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        clear: () -&gt;

            <span class="keyword">return</span> <span class="keyword">unless</span> confirm(<span class="string">'Do you want to delete?'</span>)

            <span class="property">@destroy</span>()
            <span class="property">@model</span>.clear()</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Close a profile view. Unbind, destroy, remove element and bring
content area back to right 0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        close: () -&gt;
            <span class="keyword">super</span>
            <span class="property">@app</span>.profileClosed()
            <span class="property">@app</span>.showPaneView()</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Propperly unbind and remove a profileView without removing the
html element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        destroy: () =&gt;
            <span class="keyword">super</span>
            window.collection.unbind <span class="string">'reset'</span>, <span class="property">@onReset</span>, @
            <span class="property">@app</span>.unbind <span class="string">'filter'</span>, <span class="property">@destroy</span>, @
            window.profileView = <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>When the Items collection fires a reset (usually after a refetch),
hide the profileView if the item is not anymore in the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        onReset: () =&gt;

            <span class="property">@destroy</span>() <span class="keyword">unless</span> window.collection.get <span class="property">@model</span>.id</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Initialize form elements to create/update an item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        form: (element) =&gt;

            $(<span class="string">'#pane'</span>).css <span class="string">'display'</span>, <span class="string">'block'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Enable editing for additional fields, picture or all fields if
admin key is present</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> <span class="property">@app</span>.isAdmin()

                $(<span class="string">'a.text-overlay'</span>, <span class="string">'#pane'</span>).hide()
                $(<span class="string">'input.hidden'</span>, <span class="string">'#pane'</span>).removeClass <span class="string">'hidden'</span>
                $(<span class="string">'.multiline'</span>).addClass(<span class="string">'edit'</span>).removeAttr <span class="string">'style'</span>
                $(<span class="string">'select'</span>).addClass(<span class="string">'edit'</span>).removeAttr <span class="string">'disabled'</span>
                $(<span class="string">'.text-container.tuple'</span>).hide()
                $(<span class="string">'.multilineWrapp p'</span>).hide()
                $(<span class="string">'textarea'</span>, <span class="string">'#pane'</span>)
                  .removeAttr(<span class="string">'disabled'</span>)
                  .addClass(<span class="string">'edit'</span>)
                $(<span class="string">'.tupleWrapper'</span>).removeClass(<span class="string">'hidden'</span>)
                $(<span class="string">'a.link'</span>).hide()</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Enable additional fields. No admin key required.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $a = $(<span class="string">'#pane li.additional'</span>)
            $(<span class="string">'a.text-overlay'</span>, $a).hide()
            $(<span class="string">'input.hidden'</span>, $a).removeClass <span class="string">'hidden'</span>
            $(<span class="string">'select'</span>, $a).addClass(<span class="string">'edit'</span>).removeAttr <span class="string">'disabled'</span>
            $(<span class="string">'.multilineWrapp p'</span>, $a).hide()
            $(<span class="string">'textarea'</span>, $a).removeAttr(<span class="string">'disabled'</span>).addClass(<span class="string">'edit'</span>)
            $(<span class="string">'a.link'</span>, $a).hide()</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Enable picture field</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'input#pic'</span>, <span class="string">'#pane'</span>)
                .addClass(<span class="string">'editing'</span>)
                .removeAttr(<span class="string">'disabled'</span>)
            $(<span class="string">'#pictureContainer p'</span>, <span class="string">'#pane'</span>).show()</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Show additional fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'ul'</span>, <span class="string">'#pane li.additional'</span>).addClass(<span class="string">'open'</span>)
            $(<span class="string">'span#arrow'</span>, <span class="string">'#pane li'</span>).addClass(<span class="string">'active'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Highlight mandatory fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setMandatoryLabels</span>() <span class="keyword">if</span> <span class="property">@app</span>.isAdmin()</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Set useful jquery plugins</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setAutoComplete</span> $(<span class="string">'input.autocomplete'</span>)
            <span class="property">@setFileupload</span> $(<span class="string">'input#pic'</span>)
            <span class="property">@setDatePicker</span> $(<span class="string">'input[data-type="date"]'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Unset keybindings to avoid closing profile on arrow-keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@app</span>.unsetMoveKeybindings()</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Set height of multiline fields.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setMultilineHeight</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Prepare buttons for edit state (show Save).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'#buttons a'</span>, <span class="string">'#pane'</span>).hide()
            $(<span class="string">'a#save'</span>).css(<span class="string">'display'</span>, <span class="string">'inline-block'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Saves a new item or updates an older item if data is valid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        save: (e) =&gt;

            <span class="keyword">if</span> e.charCode <span class="keyword">or</span> e.charCode <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">return</span> <span class="keyword">unless</span> e.which <span class="keyword">is</span> <span class="number">13</span>

            <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@formIsValid</span>()

            <span class="keyword">return</span> <span class="property">@create</span>() <span class="keyword">unless</span> <span class="property">@model</span>.id

            <span class="property">@update</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Creates a new item in the items collection avoiding several clicks
to trigger a create() many times.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        create: _.debounce(() -&gt;

            unset = <span class="literal">yes</span>

            <span class="property">@setModel</span> <span class="property">@model</span>, unset

            window.collection.create <span class="property">@model</span>, wait: <span class="literal">yes</span>,
                success: () =&gt;
                    <span class="property">@app</span>.hideError()
                    <span class="property">@app</span>.navigate()
                ,
                error: () =&gt;
                    <span class="property">@app</span>.showError()
        , <span class="number">1000</span>, <span class="literal">true</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Update an item with the new changes on the input fields. If an input
field is empty, the property gets removed from the item object.
Only the optional fields are changable without an admin key!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        update: (e) =&gt;

            unset = <span class="literal">yes</span>

            <span class="property">@setModel</span> <span class="property">@model</span>, unset

            <span class="property">@model</span>.save {}, wait: <span class="literal">yes</span>, error: () -&gt;
                window.App.showError()

            <span class="property">@app</span>.navigate()</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Addition fields section of the profile view, expand and collapse!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        showAdditionalFields: () -&gt;

            $(<span class="string">'ul'</span>, <span class="string">'#pane li.additional'</span>).toggleClass(<span class="string">'open'</span>)

            $(<span class="string">'span#arrow'</span>, <span class="string">'#pane li'</span>).toggleClass(<span class="string">'active'</span>)

            <span class="keyword">return</span> window.additionalOpen = <span class="literal">yes</span> <span class="keyword">if</span> window.additionalOpen <span class="keyword">is</span> <span class="literal">no</span>

            window.additionalOpen = <span class="literal">no</span></pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Add class mandatory to respective fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setMandatoryLabels: () =&gt;

            mandatoryFields = window.Settings.Schema.getMandatories()

            _.each mandatoryFields, (l) =&gt;
                $(<span class="string">"label[for='<span class="subst">#{l.id}</span>']"</span>).addClass <span class="string">'mandatory'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Sets the height for the textareas on the profile view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setMultilineHeight: (item) =&gt;

            item = <span class="property">@model</span>

            _.each window.Settings.Schema.getMultilines(), (m) -&gt;

                value = item.get m.id
                <span class="keyword">return</span> <span class="keyword">unless</span> value

                cols = $(<span class="string">"textarea#<span class="subst">#{m.id}</span>"</span>, <span class="string">'#pane'</span>).attr <span class="string">'cols'</span>
                lc = <span class="number">0</span>

                _.each value.split(<span class="string">'\n'</span>), (l) -&gt;
                    lc += Math.ceil l.length/cols

                h = $(<span class="string">"textarea#<span class="subst">#{m.id}</span>"</span>, <span class="string">'#pane'</span>).prop <span class="string">'scrollHeight'</span>
                $(<span class="string">"textarea#<span class="subst">#{m.id}</span>"</span>, <span class="string">'#pane'</span>).height h</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <h3>Group view</h3>
<p>Shows a selection of items. Allows for edition of multiple items at once,
export to CSV, create calendar, conference in Skype, etc</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="class"><span class="keyword">class</span> <span class="title">window</span>.<span class="title">GroupView</span> <span class="keyword">extends</span> <span class="title">window</span>.<span class="title">BasePaneView</span></span>

        events:

            <span class="string">"click a.destroy"</span>                         : <span class="string">"close"</span>
            <span class="string">"click a.minidestroy"</span>                     : <span class="string">"removeSelected"</span>
            <span class="string">"click #groupActions a#csv.btn"</span>           : <span class="string">"linkToCSV"</span>
            <span class="string">"click #groupActions a#edit.btn"</span>          : <span class="string">"multipleEdit"</span>
            <span class="string">"click #multipleEditActions a#cancel.btn"</span> : <span class="string">"closeEdit"</span>
            <span class="string">"click #multipleEditActions a#save.btn"</span>   : <span class="string">"save"</span>
            <span class="string">"keypress"</span>                                : <span class="string">"save"</span>
            <span class="string">"keyup .tupleField:last-child"</span>            : <span class="string">"addTupleField"</span>
            <span class="string">"focus .tupleField"</span>                       : <span class="string">"removeEmptyTupleFields"</span>


        template: _.template $(<span class="string">'#group-template'</span>).html()</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Render view by passing an array of ids and an array of emails for
the calendar function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        render: () =&gt;

            <span class="property">@$el</span>.html <span class="property">@template</span> m: <span class="property">@app</span>.itemSelection, calendar: <span class="property">@gCalendarURL</span>()
            @</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Close group view. Unbind and destroys html element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        close: () -&gt;

            <span class="keyword">super</span>

            <span class="property">@app</span>.showPaneView()</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Destroy and navigate to new state without group view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        destroy: () =&gt;

            <span class="keyword">super</span>

            window.groupView = <span class="literal">null</span>

            <span class="property">@app</span>.navigate()</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <h3>Multiple edition</h3>
<ol>
<li>Show multiple edition form</li>
<li>Hide other action buttons</li>
<li>Set autocomplete on input fields</li>
<li>Set date pickers</li>
<li>Unset arrow key movement bindings</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>        multipleEdit: () =&gt;

            $(<span class="string">'#itemsContainer'</span>).addClass <span class="string">'onEdit'</span>
            $(<span class="string">'#multipleEditFields, #multipleEditActions'</span>).show()
            $(<span class="string">'#groupActions'</span>).hide()

            <span class="property">@setAutoComplete</span> $(<span class="string">'input.autocomplete'</span>)
            <span class="property">@setDatePicker</span> $(<span class="string">'input[data-type="date"]'</span>)
            <span class="property">@app</span>.unsetMoveKeybindings()</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <h3>Save multiple items</h3>
<p>1.- Unbinds &#39;sync&#39; events from models until all models are changed.
2.- Show a warning before applying changes
3.- Set model properties for each item
4.- Rebind &#39;sync&#39; events
5.- Refetch colection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        save: (e) =&gt;

            <span class="keyword">if</span> e.charCode <span class="keyword">or</span> e.charCode <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">then</span> <span class="keyword">return</span> <span class="keyword">unless</span> e.which <span class="keyword">is</span> <span class="number">13</span>

            amount = <span class="property">@app</span>.itemSelection.length
            warning = <span class="string">"Proceed to apply changes to <span class="subst">#{amount}</span> "</span>
            warning += window.App.getItemType()
            <span class="keyword">return</span> <span class="keyword">unless</span> confirm warning

            cb = _.after <span class="property">@app</span>.itemSelection.length, () =&gt;
                <span class="property">@app</span>.fetchFacet () =&gt;
                    <span class="property">@app</span>.fetchItems
                        data: <span class="property">@app</span>.getFilterQS()

            <span class="property">@app</span>.itemSelection.each (m) =&gt;
                m.unbind <span class="string">'sync'</span>, <span class="property">@app</span>.updateFacets

                <span class="property">@setModel</span> m, <span class="literal">no</span>, () =&gt;
                    m.save {},
                      wait: <span class="literal">yes</span>,
                      url: m.url() + <span class="string">'?admin=yes'</span>,
                      success: () =&gt;
                          <span class="property">@app</span>.hideError()
                          m.bind <span class="string">'sync'</span>, <span class="property">@app</span>.updateFacets
                          cb()

            <span class="property">@closeEdit</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Hide multiple edition fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        closeEdit: () =&gt;

            $(<span class="string">'input'</span>, <span class="string">'#multipleEditFields'</span>).val <span class="string">''</span>
            $(<span class="string">'#itemsContainer'</span>).removeClass <span class="string">'onEdit'</span>
            $(<span class="string">'#multipleEditFields, #multipleEditActions'</span>).hide()
            $(<span class="string">'#groupActions'</span>).show()</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Deselects 1 item and takes it out from selection array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        removeSelected: (e) =&gt;

            $e = $(e.currentTarget).parent(<span class="string">'li'</span>)
            id = $e.attr <span class="string">'id'</span>

            <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@app</span>.itemSelection.get id

            <span class="property">@app</span>.itemSelection.remove id

            $(<span class="string">"#<span class="subst">#{id}</span>"</span>, <span class="string">"#items"</span>).removeClass <span class="string">'active'</span>

            $e.remove()

            <span class="property">@app</span>.navigate()</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Export selected items to CSV txt file in new window/tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        linkToCSV: () =&gt;

            url = <span class="string">'collection?&amp;csv=true&amp;'</span>
            qs = []

            window.App.itemSelection.each (m) -&gt;
                qs.push <span class="string">"fs=id:<span class="subst">#{m.id}</span>"</span>

            window.open url + qs.join <span class="string">'&amp;'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Forms the URL for the Calendar button.
&#39;;&#39; concatenated list of emails from selected items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        gCalendarURL: () =&gt;

            emails = []
            <span class="property">@app</span>.itemSelection.each (m) =&gt;
                emails.push m.get <span class="string">'email'</span>

            now = <span class="keyword">new</span> Date()
            year = now.getFullYear()
            month = now.getMonth() + <span class="number">1</span>
            <span class="keyword">if</span> month &lt; <span class="number">10</span> <span class="keyword">then</span> month = <span class="string">'0'</span> + month
            day = now.getDate()
            <span class="keyword">if</span> day &lt; <span class="number">10</span> <span class="keyword">then</span> day = <span class="string">'0'</span> + day
            defaultDate = year + month + day

            fromHour = now.getHours() + <span class="number">1</span>
            toHour = now.getHours() + <span class="number">2</span>
            offset = now.getTimezoneOffset()/<span class="number">60</span>

            fromHour += offset
            toHour += offset
            <span class="keyword">if</span> fromHour &lt; <span class="number">10</span> <span class="keyword">then</span> fromHour = <span class="string">'0'</span> + fromHour
            <span class="keyword">if</span> toHour &lt; <span class="number">10</span> <span class="keyword">then</span> toHour = <span class="string">'0'</span> + toHour

            fromDate = defaultDate + <span class="string">'T'</span> + fromHour + <span class="string">'0000Z'</span>
            toDate = defaultDate + <span class="string">'T'</span> + toHour + <span class="string">'0000Z'</span>

            baseURL = <span class="string">"http://www.google.com/calendar/event?action=TEMPLATE"</span>
            baseURL += <span class="string">"&amp;text=Please%20add%20a%20title%20for%20this%20event..."</span>
            baseURL += <span class="string">"&amp;dates=<span class="subst">#{fromDate}</span>/<span class="subst">#{toDate}</span>&amp;details=&amp;location="</span>
            baseURL += <span class="string">"&amp;add=<span class="subst">#{emails.toString()}</span>&amp;trp=false&amp;sprop=&amp;sprop=name:"</span>
            baseURL</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <h3>Pane view</h3>
<p>Shows a detailed view of a facet field. Allows for different templates
based on entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="class"><span class="keyword">class</span> <span class="title">window</span>.<span class="title">PaneView</span> <span class="keyword">extends</span> <span class="title">window</span>.<span class="title">BasePaneView</span></span>

        events:
            <span class="string">"click a.destroy"</span>     : <span class="string">"reset"</span>

        template: () -&gt;
            _.template $(<span class="string">"#extensions #pane-template"</span>).html()

        initialize: (<span class="property">@template</span>, <span class="property">@field</span>) =&gt;
            <span class="keyword">super</span>

        reset: () =&gt;
            $(<span class="property">@el</span>).trigger <span class="string">'close'</span>

        render: () =&gt;
            <span class="property">@$el</span>.html <span class="property">@template</span> <span class="property">@field</span>
            @

        destroy: () =&gt;
            window.paneView = <span class="literal">null</span>
            <span class="keyword">super</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
