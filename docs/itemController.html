<!DOCTYPE html>

<html>
<head>
  <title>#</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.coffee
              </a>
            
              
              <a class="source" href="collection.html">
                collection.coffee
              </a>
            
              
              <a class="source" href="facets.html">
                facets.coffee
              </a>
            
              
              <a class="source" href="index.html">
                index.coffee
              </a>
            
              
              <a class="source" href="facetArray.html">
                facetArray.coffee
              </a>
            
              
              <a class="source" href="schema.html">
                schema.coffee
              </a>
            
              
              <a class="source" href="facet.html">
                facet.coffee
              </a>
            
              
              <a class="source" href="item.html">
                item.coffee
              </a>
            
              
              <a class="source" href="print.html">
                print.coffee
              </a>
            
              
              <a class="source" href="routes.html">
                routes.coffee
              </a>
            
              
              <a class="source" href="facet.html">
                facet.coffee
              </a>
            
              
              <a class="source" href="item.html">
                item.coffee
              </a>
            
              
              <a class="source" href="profile.html">
                profile.coffee
              </a>
            
              
              <a class="source" href="cube.html">
                cube.coffee
              </a>
            
              
              <a class="source" href="code.html">
                code.coffee
              </a>
            
              
              <a class="source" href="server.config.html">
                server.config.coffee
              </a>
            
              
              <a class="source" href="server.routes.html">
                server.routes.coffee
              </a>
            
              
              <a class="source" href="server.settings.html">
                server.settings.coffee
              </a>
            
              
              <a class="source" href="entityController.html">
                entityController.coffee
              </a>
            
              
              <a class="source" href="extensionController.html">
                extensionController.coffee
              </a>
            
              
              <a class="source" href="facetManager.html">
                facetManager.coffee
              </a>
            
              
              <a class="source" href="itemController.html">
                itemController.coffee
              </a>
            
              
              <a class="source" href="printController.html">
                printController.coffee
              </a>
            
              
              <a class="source" href="schema.html">
                schema.coffee
              </a>
            
              
              <a class="source" href="solrManager.html">
                solrManager.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>#</h1>
<p>ItemController.coffee</p>
<p>Serves routes for items. i.e. Any url that contains one or more ids.</p>
<p>@author: Emanuel Lauria <a href="&#x6d;&#x61;&#105;&#x6c;&#x74;&#x6f;&#58;&#x65;&#x6d;&#x61;&#110;&#117;&#101;&#108;&#46;&#x6c;&#97;&#117;&#x72;&#x69;&#x61;&#64;&#x7a;&#97;&#x6c;&#x61;&#x6e;&#100;&#x6f;&#x2e;&#x64;&#101;">&#x65;&#x6d;&#x61;&#110;&#117;&#101;&#108;&#46;&#x6c;&#97;&#117;&#x72;&#x69;&#x61;&#64;&#x7a;&#97;&#x6c;&#x61;&#x6e;&#100;&#x6f;&#x2e;&#x64;&#101;</a></p>
<h1>#</h1>
<p>Requirements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>fs    = require <span class="string">'fs'</span>
_     = require <span class="string">'underscore'</span>
async = require <span class="string">'async'</span>
im    = require <span class="string">"imagemagick"</span>
mime  = require <span class="string">"mime-magic"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Server settings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>settings = require <span class="string">"<span class="subst">#{__dirname}</span>/../server.settings.coffee"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Solr Manager to add/remove solr suffixes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>SolrManager = require <span class="string">'./solrManager.coffee'</span>

<span class="class"><span class="keyword">class</span> <span class="title">ItemController</span></span>

    module.exports = ItemController</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Routes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    constructor: (app) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Get a single item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        app.get     <span class="string">"/:entity/collection/:id"</span>,  (a...)  =&gt; <span class="property">@get</span>     a...</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Create a new item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        app.post    <span class="string">"/:entity/collection"</span>,      (a...)  =&gt; <span class="property">@post</span>    a...</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Update an existing item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        app.put     <span class="string">"/:entity/collection/:id"</span>,  (a...)  =&gt; <span class="property">@put</span>     a...</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Remove an item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        app.<span class="keyword">delete</span>  <span class="string">"/:entity/collection/:id"</span>,  (a...)  =&gt; <span class="property">@delete</span>  a...</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Get an item or an array of items from IDs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    get: (req, res) =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Name of entity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        name = req.params.entity</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Item ID</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        id = req.params.id.split(<span class="string">'|'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Return just 1 item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> id.length <span class="keyword">is</span> <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">return</span> <span class="property">@getItemById</span> name, id[<span class="number">0</span>], (docs) -&gt;
            res.send docs</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Return an array of items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        docs = []

        async.forEach id, (id, cb) =&gt;
            <span class="property">@getItemById</span> name, id, (item) -&gt;
                docs.push item[<span class="number">0</span>]
                cb()
        , (err) -&gt;
            <span class="keyword">throw</span> err <span class="keyword">if</span> err
            <span class="keyword">return</span> res.send docs</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Create a new item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    post: (req, res) =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Entity  name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        name = req.params.entity</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Create solr manager for this entity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        solrManager = <span class="keyword">new</span> SolrManager name

        db = solrManager.createClient()</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Create and ID for the new item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        id = <span class="property">@generateId</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Get the id of the picture field</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        picKey = <span class="property">@getPictureFields</span>(name)[<span class="number">0</span>]?.id</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Create a new item with id</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        item = _.extend {id: id}, solrManager.addObjSuffix name, req.body</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Send the formed item with id unless there is a picture</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> !req.body[picKey]
            <span class="keyword">return</span> <span class="property">@addItem</span> res, solrManager, item, (_item) =&gt;
                res.send solrManager.removeSuffix _item</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Get pic url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        tmp_pic = <span class="string">"<span class="subst">#{__dirname}</span>/../public/<span class="subst">#{req.body[picKey]}</span>"</span>
        target_file = <span class="string">"<span class="subst">#{id}</span>.jpg"</span>
        target_path = <span class="string">"<span class="subst">#{__dirname}</span>/../public/images/<span class="subst">#{name}</span>/<span class="subst">#{target_file}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Move the picture to its final place and send item object back</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        fs.rename tmp_pic, target_path, (err) =&gt;
            <span class="keyword">throw</span> err <span class="keyword">if</span> err
            key = solrManager.addSuffix(name, picKey)
            item[key] = <span class="string">"/images/<span class="subst">#{name}</span>/<span class="subst">#{target_file}</span>"</span> <span class="keyword">unless</span> err
            <span class="property">@addItem</span> res, solrManager, item, (_item) =&gt;
                res.send solrManager.removeSuffix _item</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Update an item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    put: (req, res) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Entity name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        name = req.params.entity</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Solr manager for this entity to handle suffixes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        solrManager = <span class="keyword">new</span> SolrManager name

        db = solrManager.createClient()</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Picture id</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        picKey = solrManager.addSuffix name, <span class="property">@getPictureFields</span>(name)[<span class="number">0</span>]?.id</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Get item from db with ID</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="property">@getItemById</span> name, req.params.id, (result) =&gt;

            item = solrManager.addObjSuffix(name, result[<span class="number">0</span>])

            req.body = solrManager.addObjSuffix(name, req.body)</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>If client is admin, all fields are updated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> req.query.admin <span class="keyword">isnt</span> <span class="string">'yes'</span>
                protectedFields = <span class="property">@getFieldsWithProperty</span> name, <span class="string">'admin'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Update protected fields (additional: false)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                _.each protectedFields, (f) =&gt;
                    f = solrManager.addSuffix(name, f)
                    req.body[f.key] = item[f.key]</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>If its a multivalue field, add a copy field with its
array stringified, so search and sort work on this field.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="keyword">if</span> f.multivalue
                        multivalueField = item[f.key].sort().join(<span class="string">" "</span>)
                        req.body[<span class="string">"sort_<span class="subst">#{f.key}</span>-s"</span>] = multivalueField</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>If there is no picture field, respond with updated item object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> !req.body[picKey] <span class="keyword">or</span> req.body[picKey] <span class="keyword">is</span> item[picKey]
                <span class="keyword">return</span> <span class="property">@addItem</span> res, solrManager, req.body, (_item) =&gt;
                    res.send solrManager.removeSuffix _item</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Update picture field and respond.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@updatePic</span> item.id, name, req.body[picKey], item[picKey], (path) =&gt;
                req.body[picKey] = path
                <span class="property">@addItem</span> res, solrManager, req.body, (_item) =&gt;
                    res.send solrManager.removeSuffix _item</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Remove item and its picture (if it has).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">delete</span>: (req, res) =&gt;
        name = req.params.entity
        id = req.params.id
        solrManager = <span class="keyword">new</span> SolrManager name
        db = solrManager.createClient()
        picKey = <span class="property">@getPictureFields</span>(name)[<span class="number">0</span>]?.id

        <span class="property">@getItemById</span> name, id, (docs) =&gt;
            _.each docs, (item) -&gt;
                solrManager.client.deleteByID id, (err, result) -&gt;
                    <span class="keyword">throw</span> err <span class="keyword">if</span> err
                    res.send result
                <span class="keyword">return</span> <span class="keyword">unless</span> picKey
                imgPath = <span class="string">"<span class="subst">#{__dirname}</span>/../public/<span class="subst">#{item[picKey]}</span>"</span>
                fs.unlink imgPath, (err) -&gt;
                    console.log <span class="string">"Failed to remove pic for user <span class="subst">#{id}</span>"</span> <span class="keyword">if</span> err</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Update picture removing old picture and renaming new one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    updatePic: (id, name, bodyPic, itemPic, cb) =&gt;
        tmp_pic = <span class="string">"<span class="subst">#{__dirname}</span>/../public/<span class="subst">#{bodyPic}</span>"</span>
        rnd = bodyPic.slice(<span class="number">21</span>, <span class="number">24</span>)
        target_file = <span class="string">"/images/<span class="subst">#{name}</span>/<span class="subst">#{id}</span>_<span class="subst">#{rnd}</span>.jpg"</span>
        target_path = <span class="string">"<span class="subst">#{__dirname}</span>/../public/<span class="subst">#{target_file}</span>"</span>

        fs.stat tmp_pic, (err, stat) -&gt;
            <span class="keyword">if</span> err <span class="keyword">then</span> console.log <span class="string">"ERROR[uid=<span class="subst">#{id}</span>]: No uploaded picture"</span>
            fs.unlink <span class="string">"<span class="subst">#{__dirname}</span>/../public/<span class="subst">#{itemPic}</span>"</span>, (err) -&gt;
                fs.rename tmp_pic, target_path, (err) -&gt;
                    <span class="keyword">throw</span> err <span class="keyword">if</span> err
                    cb target_file</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Get an Item by its ID</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getItemById: (name, id, cb) -&gt;

        solrManager = <span class="keyword">new</span> SolrManager name

        db = solrManager.createClient()

        query = db.createQuery()
            .q(<span class="string">"id:<span class="subst">#{id}</span>"</span>)
            .start(<span class="number">0</span>)
            .rows(<span class="number">1000</span>)

        db.search query, (err, result) -&gt;
            <span class="keyword">throw</span> err <span class="keyword">if</span> err
            docs = []
            _.each result.response?.docs, (doc) -&gt;
                docs.push solrManager.removeSuffix doc
            cb docs</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Get Picture fields from schema (type: &quot;img&quot;).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getPictureFields: (name) -&gt;
        schema = require <span class="string">"<span class="subst">#{__dirname}</span>/../entities/<span class="subst">#{name}</span>/schema.json"</span>
        arr = []
        _.each schema, (o) =&gt;
            arr.push o <span class="keyword">if</span> o.type <span class="keyword">is</span> <span class="string">"img"</span>
        arr</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Add an item to the solr db</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    addItem: (res, solrManager, item, cb) =&gt;
        _item = _.extend {}, item
        solrManager.client.add [item], (err, result) -&gt;
            <span class="keyword">throw</span> err <span class="keyword">if</span> err
            cb _item</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Get all schema fields that cointain a specific property
TODO Get from schema class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getFieldsWithProperty: (name, p) -&gt;
        schema = require <span class="string">"<span class="subst">#{__dirname}</span>/../entities/<span class="subst">#{name}</span>/schema.json"</span>
        arr = []
        _.each schema, (o) =&gt;
            arr.push o <span class="keyword">if</span> o[p]
        arr</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Get all fields that have a specific type in an entity&#39;s schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getFieldsByType: (name, t) -&gt;
        schema = require <span class="string">"<span class="subst">#{__dirname}</span>/../entities/<span class="subst">#{name}</span>/schema.json"</span>
        arr = []
        _.each schema, (o) =&gt;
            arr.push o <span class="keyword">if</span> o.type <span class="keyword">is</span> t
        arr</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Generate an ID for the item on the db</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    generateId: () -&gt;
        chars = <span class="string">"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"</span>
        today = <span class="keyword">new</span> Date()
        result = today.valueOf().toString <span class="number">16</span>
        result += chars.substr Math.floor(Math.random() * chars.length), <span class="number">1</span>
        result += chars.substr Math.floor(Math.random() * chars.length), <span class="number">1</span>
        result</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
